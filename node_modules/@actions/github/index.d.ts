export interface RepositoryContext {
  owner?: string;
  repo?: string;
}

export interface PullRequestPayload {
  pull_request?: {
    number?: number;
  };
  repository?: {
    name?: string;
    owner?: {
      login?: string;
    };
  };
}

export interface ListFilesParams {
  owner: string;
  repo: string;
  pull_number: number;
  per_page?: number;
  page?: number;
}

export interface FileListResponse {
  data: Array<{ filename: string }>;
}

export interface PullRequestParams {
  owner: string;
  repo: string;
  pull_number: number;
}

export interface PullRequestResponse {
  data: {
    title?: string;
    html_url: string;
    head?: {
      sha?: string;
    };
  };
}

export interface ListReviewCommentsParams extends ListFilesParams {}

export interface PullRequestReviewComment {
  id: number;
  in_reply_to_id?: number;
  path?: string;
  body?: string;
  user?: {
    login?: string;
  };
  line?: number | null;
  original_line?: number | null;
  created_at?: string;
}

export interface ListReviewCommentsResponse {
  data: PullRequestReviewComment[];
}

export interface CreateReviewCommentParams {
  owner: string;
  repo: string;
  pull_number: number;
  body: string;
  commit_id?: string;
  path?: string;
  line?: number;
  side?: 'LEFT' | 'RIGHT';
  in_reply_to?: number;
}

export interface GetContentParams {
  owner: string;
  repo: string;
  path: string;
  ref?: string;
}

export interface RepositoryContentFile {
  type?: string;
  content?: string;
  encoding?: string;
}

export interface RepositoryContentResponse {
  data: RepositoryContentFile | RepositoryContentFile[];
}

export type PaginateMap<TInput, TOutput> = (value: TInput) => TOutput;

export interface Octokit {
  rest: {
    pulls: {
      listFiles(params: ListFilesParams): Promise<FileListResponse>;
      get(params: PullRequestParams): Promise<PullRequestResponse>;
      listReviewComments(params: ListReviewCommentsParams): Promise<ListReviewCommentsResponse>;
      createReviewComment(params: CreateReviewCommentParams): Promise<{ data: unknown }>;
    };
    repos: {
      getContent(params: GetContentParams): Promise<RepositoryContentResponse>;
    };
  };
}

export const context: {
  payload: PullRequestPayload;
  repo: RepositoryContext;
};

export function getOctokit(token: string): Octokit;

export function paginate<TParams, TResponse, TResult>(
  method: (parameters: TParams) => Promise<TResponse>,
  parameters: TParams,
  mapFn: PaginateMap<TResponse, TResult[]>
): Promise<TResult[]>;
